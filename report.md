# マルチチャネル返信支援Chrome拡張 PoC 調査レポート

## 1. 概要

本PoCでは、複数チャネル（Gmail、Chatwork、LINEなど）のメッセージに対し、LLM（大規模言語モデル）を用いた返信案生成を支援するChrome拡張機能のプロトタイプ開発を行いました。主要な目標は、どのコミュニケーション窓口からのメッセージでも一貫したUIで返信案の生成・編集・送信を可能にすることです。

現時点では**Gmailにおける基本的な返信支援機能の実装が完了**しており、現在は**Chatworkへの機能拡張に着手**しています。

---

## 2. 目的

本PoCが目指す主要な目的は以下の3点です。

* **複数チャネルでの一貫したUI提供**: ユーザーがどのチャネルを利用していても、統一された操作感で返信支援機能を利用できるようにする。
* **LLMを活用した返信案生成**: LLMの能力を最大限に活用し、効率的かつ質の高い返信案を自動生成する。
* **ワンクリック送信の実現**: 返信案の生成から編集、そして最終的な送信までを極力少ない操作で完結させることで、ユーザー体験を向上させる。

---

## 3. 対象チャネルと対応状況

各チャネルに対する調査結果と実装状況は以下の通りです。

| チャネル           | 対応状況   | 補足                                                         |
| :----------------- | :--------- | :----------------------------------------------------------- |
| **Gmail** | ✅ **実装済み** | Chrome拡張機能からの **DOM操作によるUI挿入、返信案表示、およびGmail APIを利用した送信処理** が概ね完了しています。 |
| **Chatwork** | 🛠 **実装中** | UI要素の挿入は確認済みです。しかし、ChatworkのJavaScriptによる**動的なDOM構造**に対応するため、安定したセレクタの特定と複雑なJS構造への適合に現在取り組んでいます。 |
| **LINE** | 🔍 **調査済み** | **React製SPA**であり、セキュリティ上の制約からChrome拡張機能からのDOM操作によるUI挿入は**困難であると判断**しました。 |
| **Facebook Messenger** | 🔍 **調査済み** | **iframe内のDOM構造**が複雑であり、現時点では拡張機能からの安定したDOM操作は難しいと判断し、実装には未着手です。 |
| **Google Chat** | 🔍 **調査済み** | **iframeとSPAの複合的な構造**であり、こちらも実装難易度が高いと判断しています。 |

---

## 4. 技術構成

本PoC開発における主な技術スタックとプロジェクト構成は以下の通りです。

### 4.1. 言語・フレームワーク

* **TypeScript**: 型安全な開発と保守性の向上を目的として採用。
* **tsc (TypeScript Compiler)**: TypeScriptコードのJavaScriptへのコンパイルに利用。静的ファイルのコピーには別途npmスクリプトを使用。

### 4.2. プロジェクト構成

現在のリポジトリ構成に基づいています。

```

chatwork-reply-extension/
├── src/                        \# ソースコード
│   ├── content\_script.ts       \# 主要なコンテンツスクリプト
│   └── content\_script\_chatwork.ts \# Chatworkに特化したコンテンツスクリプト
├── manifest.json               \# マニフェストファイル
├── package.json
├── package-lock.json
├── tsconfig.json
├── .gitignore
├── README.md
├── (その他、画像ファイル - 例: chatwork-script-success-log.png など)
└── (dist/ はビルド成果物なので .gitignore で除外)

```

---

## 5. 開発進捗

### 5.1. ✅ 実装済み機能

* **Gmail向け返信UIの挿入**: GmailのUI内に返信支援ボタンとモーダルウィンドウを挿入。
* **Gmail APIを用いた送信処理**: 生成された返信案をGmail APIを通じて送信する機能。
* **Content Script と Service Worker 間のメッセージ通信**: 各チャネルのUI操作とバックグラウンド処理の連携。
* **ビルド設定の確立**: `tsconfig.json` と `package.json` のスクリプト（`tsc` および `shx` を利用した静的ファイルコピー）により、Chrome拡張機能のビルド設定が完了。

### 5.2. 🛠 実装中機能

* **ChatworkのDOM解析とUI挿入**: Chatwork上の既存のDOM構造を解析し、返信UIを適切に挿入する作業を進めています。
* **`manifest.json`の`host_permissions`対応**: 各チャネルへのアクセス権限設定を検証・調整中。

---

## 6. 課題・懸念点

開発を進める中で、以下の課題と懸念点が浮上しています。

* **動的DOMへの対応**: ChatworkのようなJavaScriptによって構築される動的なDOM構造を持つサービスでは、安定したDOMセレクタの特定と、ページの更新への追従が技術的な課題です。
* **iframe構造を持つサービスへの対応**: LINEやGoogle Chatのように`iframe`内にコンテンツが表示されるサービスでは、Chrome拡張機能の**セキュリティ制限**により、`iframe`内部へのスクリプト挿入やDOM操作が極めて困難です。これは、これらのチャネルへの直接的なUI統合において大きな制約となります。
* **Manifest V3 `service_worker.ts`の仕様制限**: Manifest V3では、サービスワーカーが永続的ではない（アイドル状態になると終了する）ため、リアルタイムな通信制御や、永続的な状態管理に工夫が必要です。

---

## 7. 今後の予定

提出期限に向け、以下の項目を優先的に進める予定です。

1.  **Chatwork返信UIのDOM注入完了と編集機能の追加**: Chatwork上での返信案の表示と編集機能の実装を完了させます。
2.  **LLMによる返信案挿入の共通化**: GmailとChatworkを含む各チャネルで、LLMによる返信案生成機能を共通化し、再利用可能な形で実装します。
3.  **各チャネルのオプション設定画面の実装**: （もし `options.html` を追加する予定があれば）それを利用した各チャネル固有の設定画面を実装します。
4.  **LLM呼び出し部分の切り出しと共通化**: LLMへのAPI呼び出しロジックを独立させ、チャネルを問わず利用できるように共通化します。
5.  **最終確認と提出準備**:
    * 主要機能のテスト。
    * GitHubリポジトリのREADMEに、環境構築と動作手順を明確に記載。
    * 任意のデモ動画の作成（可能であれば）。

---

## 8. 備考

* 本拡張機能のコードは以下のGitHubリポジトリにて管理しています：
    👉 [https://github.com/shizuka95/chatwork-reply-extension](https://github.com/shizuka95/chatwork-reply-extension)
* 開発中に一時的にローカルデータが消失しましたが、GitHubリポジトリのおかげで完全に復元することができました。
* 提出期限直前のビルド構成（`package.json`スクリプトと`tsconfig.json`）の修正も完了しており、最低限の提出用成果物は整備済みです。

---
```